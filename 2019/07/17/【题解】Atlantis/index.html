<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>【题解】Atlantis - bn&#039; Blog</title><meta description="矩阵面积并问题：扫描线法+线段覆盖……"><meta property="og:type" content="blog"><meta property="og:title" content="【题解】Atlantis"><meta property="og:url" content="https://big-news.cn/2019/07/17/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91Atlantis/"><meta property="og:site_name" content="bn&#039; Blog"><meta property="og:description" content="矩阵面积并问题：扫描线法+线段覆盖……"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://upl.big-news.cn/2019/07/17/atl1.png"><meta property="og:image" content="https://upl.big-news.cn/2019/07/17/atl2.png"><meta property="og:image" content="https://upl.big-news.cn/2019/07/17/atl3.png"><meta property="article:published_time" content="2019-07-17T02:41:00.000Z"><meta property="article:modified_time" content="2020-08-09T01:30:11.240Z"><meta property="article:author" content="big-news"><meta property="article:tag" content="线段树"><meta property="article:tag" content="扫描线法"><meta property="article:tag" content="线段覆盖"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://upl.big-news.cn/2019/07/17/atl1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://big-news.cn/2019/07/17/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91Atlantis/"},"headline":"bn' Blog","image":["https://upl.big-news.cn/2019/07/17/atl1.png","https://upl.big-news.cn/2019/07/17/atl2.png","https://upl.big-news.cn/2019/07/17/atl3.png"],"datePublished":"2019-07-17T02:41:00.000Z","dateModified":"2020-08-09T01:30:11.240Z","author":{"@type":"Person","name":"big-news"},"description":"矩阵面积并问题：扫描线法+线段覆盖……"}</script><link rel="canonical" href="https://big-news.cn/2019/07/17/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91Atlantis/"><link rel="alternative" href="/atom.xml" title="bn&#039; Blog" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.13.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/zenburn.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><script type="text/javascript" src="/js/night.js"></script><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="bn&#039; Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/friends.html">友链</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Fork Me On GitHub" href="https://github.com/ce-amtic/ce-amtic.github.io"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-07-17T02:41:00.000Z" title="2019-07-17T02:41:00.000Z">2019-07-17</time><span class="level-item"><a class="link-muted" href="/categories/%E9%A2%98%E8%A7%A3/">题解</a><span> / </span><a class="link-muted" href="/categories/%E9%A2%98%E8%A7%A3/HDU/">HDU</a></span><span class="level-item">5 分钟 读完 (大约 709 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">【题解】Atlantis</h1><div class="content"><p>矩阵面积并问题：扫描线法+线段覆盖……</p>
<a id="more"></a>

<h1 id="一-题目"><a href="#一-题目" class="headerlink" title="一 题目"></a>一 题目</h1><blockquote>
<p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=1542">Source</a></p>
</blockquote>
<h2 id="Descriptions"><a href="#Descriptions" class="headerlink" title="Descriptions"></a>Descriptions</h2><p>There are several ancient Greek texts that contain descriptions of the fabled island Atlantis. Some of these texts even include maps of parts of the island. But unfortunately, these maps describe different regions of Atlantis. Your friend Bill has to know the total area for which maps exist. You (unwisely) volunteered to write a program that calculates this quantity.</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>The input file consists of several test cases. Each test case starts with a line containing a single integer n (1&lt;=n&lt;=100) of available maps. The n following lines describe one map each. Each of these lines contains four numbers x1;y1;x2;y2 (0&lt;=x1&lt;x2&lt;=100000;0&lt;=y1&lt;y2&lt;=100000), not necessarily integers. The values (x1; y1) and (x2;y2) are the coordinates of the top-left resp. bottom-right corner of the mapped area.</p>
<p>The input file is terminated by a line containing a single 0. Don’t process it.</p>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>For each test case, your program should output one section. The first line of each section must be “Test case #k”, where k is the number of the test case (starting with 1). The second one must be “Total explored area: a”, where a is the total explored area (i.e. the area of the union of all rectangles in this test case), printed exact to two digits to the right of the decimal point.</p>
<p>Output a blank line after each test case.</p>
<hr>
<h1 id="二-题解"><a href="#二-题解" class="headerlink" title="二 题解"></a>二 题解</h1><h2 id="题目大意"><a href="#题目大意" class="headerlink" title="题目大意"></a>题目大意</h2><p>二维平面内有n个矩形，有些矩形两两相交。给出矩形主对角线的两个端点的坐标（可能不是整数），试求矩形所覆盖的总面积。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p><strong>扫描线法</strong><br>假设我们有一条平行于y轴的线段，从y轴开始不断向x轴正方向平移。我们可以根据这条线段把这个若干矩形组成的不规则图形划分成若干部分（实际上是根据每个矩形平行于y轴的那些边），如下图：</p>
<p><img src="https://upl.big-news.cn/2019/07/17/atl1.png" alt="二.2(1) 扫描线"></p>
<p>这样划分，那么每两条相邻的扫描线之间的图形面积就可以快速的求出，因为这部分图形都是矩形，且有相同的宽（即两条扫描线之间的距离）。<br>那么我们只需要求出图形的高之和，也就是若干条线段的并。</p>
<p><strong>线段覆盖</strong><br>如下图，两条扫描线之间的部分是两个不相交的矩形，它们的并的面积可以用下面的式子求出。</p>
<p><img src="https://upl.big-news.cn/2019/07/17/atl2.png" alt="二.2(2) 线段覆盖"></p>
<p>$(x_2-x_1)$这个值实际上枚举扫描线就可以确定，关键是求出$h$的值。单看$h$在y轴上的投影（图二），不难发现$h$是若干线段的并。于是我们不妨这样想：把每个矩形看成两条相等的线段（高），那么我们在扫描的过程中会先后遇到这两条线段。第一次遇到时，我们在y轴上投影这条线段（也可以看成把它覆盖在y轴上），第二次遇到时，我们把这条线段从y轴上删除。于是我们只需要求出某一时刻，在y轴上的所有线段之并就好了。</p>
<p>那么实际上我们要维护这样一个东西：维护若干线段的并的长度，支持删除或插入一段线段。</p>
<p>那么就可以引入“线段覆盖”这个概念。实际上就是一棵节点维护的是一条“线段”的线段树，树上的每个节点维护在某个区间$[l,r]$内被覆盖的线段长度。详细定义如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span>&#123;</span> </span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> l,r; <span class="comment">//节点所维护的区间</span></span><br><span class="line">    <span class="keyword">int</span> cnt; <span class="comment">//这个区间被完全覆盖的次数</span></span><br><span class="line">    <span class="keyword">int</span> len; <span class="comment">//这个区间被覆盖的长度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下图，每条线段两头的标号代表节点所维护的线段的两个端点（离散化之后）：</p>
<p><img src="https://upl.big-news.cn/2019/07/17/atl3.png" alt="二.2(3) 维护“线段”的线段树"></p>
<p>不难发现线段是满足“区间加法”的性质的，因为在合并时，父区间若未被完全覆盖，则父区间维护的线段长度一定是子区间维护值的和，否则就是子区间的覆盖长度之和。另外还需要对线段的端点进行离散化，细节参见代码。</p>
<h2 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h2><p>坐标是可能有小数的，因此需要离散化，详见代码。</p>
<p>其次，因为线段树上的每段区间只能划分成$[l,mid]$和$[mid+1,r]$这两个子区间，否则会无限递归。但是如果把 所维护线段的端点 和 线段树的端点 设定为一个点，实际上$[mid,mid+1]$这个区间是被扔掉了的。因此我们若要修改$[l,r]$区间的值，必须调用递归修改$[l,r-1]$区间，然后在回溯更新区间大小的时候，按照$[l,r]$区间更新就好了，正确性请自行验证。</p>
<p>代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DB double</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s=<span class="number">0</span>,ne=<span class="number">1</span>; <span class="keyword">char</span> c=getchar();</span><br><span class="line">    <span class="keyword">for</span>(;c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>;c=getchar()) <span class="keyword">if</span>(c==<span class="string">'-'</span>) ne=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>;c=getchar()) s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+c-<span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">return</span> s*ne;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> CN = <span class="number">2010</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">segment</span>&#123;</span> <span class="comment">//定义一条线段</span></span><br><span class="line">  <span class="keyword">public</span>: DB l,r,x; </span><br><span class="line">    <span class="keyword">int</span> f; <span class="comment">//线段的值(1或-1) </span></span><br><span class="line">    <span class="comment">/*矩形的对边的值分别为1 -1，这样当扫描完这个矩形的时候，这两条线段会抵消掉*/</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> segment&amp; a)<span class="keyword">const</span> </span><br><span class="line">    &#123;<span class="keyword">return</span> x &lt; a.x;&#125;  <span class="comment">//按横坐标排序</span></span><br><span class="line">&#125;s[<span class="number">2</span>*CN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,scnt = <span class="number">0</span>,pcnt = <span class="number">0</span>; <span class="comment">//线段的数量:scnt 离散化后点的数量:pcnt</span></span><br><span class="line">DB pos[<span class="number">2</span>*CN],ans; <span class="comment">//pos:离散化后每个点对应的原始值 ans:面积和</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span>&#123;</span> <span class="comment">//定义线段树的一个节点</span></span><br><span class="line">  <span class="keyword">public</span>: DB len; <span class="comment">//被覆盖的长度</span></span><br><span class="line">      <span class="keyword">int</span> cnt;  <span class="comment">//是否被整段覆盖 (被整段覆盖的次数)</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">st</span>&#123;</span> <span class="comment">//线段树</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">      node d[<span class="number">8</span>*CN];</span><br><span class="line">      <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123; <span class="comment">//建树</span></span><br><span class="line">          d[k].cnt = <span class="number">0</span>; d[k].len = <span class="number">0</span>; <span class="comment">//没有被覆盖</span></span><br><span class="line">          <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">          <span class="keyword">int</span> m = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">          build(l,m,k&lt;&lt;<span class="number">1</span>);</span><br><span class="line">          build(m+<span class="number">1</span>,r,k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">DB <span class="title">get_len</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123; <span class="comment">//更新线段长度</span></span><br><span class="line">        <span class="keyword">if</span>(d[k].cnt) <span class="keyword">return</span> pos[r+<span class="number">1</span>]-pos[l]; <span class="comment">//被整段覆盖，r要+1</span></span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//不是线段</span></span><br><span class="line">        <span class="keyword">return</span> d[k&lt;&lt;<span class="number">1</span>].len + d[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].len; <span class="comment">//子区间求和</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k,<span class="keyword">int</span> s,<span class="keyword">int</span> t,<span class="keyword">int</span> x)</span></span>&#123; <span class="comment">//修改</span></span><br><span class="line">        <span class="keyword">if</span>(s&lt;=l &amp;&amp; r&lt;=t)&#123; <span class="comment">//被包含</span></span><br><span class="line">            d[k].cnt += x; <span class="comment">//更新覆盖情况</span></span><br><span class="line">            d[k].len = get_len(l,r,k); <span class="comment">//更新</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//不被包含</span></span><br><span class="line">        <span class="keyword">int</span> m = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(s &lt;= m) modify(l,m,k&lt;&lt;<span class="number">1</span>,s,t,x);</span><br><span class="line">        <span class="keyword">if</span>(m &lt; t) modify(m+<span class="number">1</span>,r,k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,s,t,x);</span><br><span class="line">        d[k].len = get_len(l,r,k); <span class="comment">//更新</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;sgt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    n = read();</span><br><span class="line">    <span class="keyword">int</span> kase = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(n)&#123;</span><br><span class="line">        ans = <span class="number">0</span>; scnt = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            DB x1,y1,x2,y2;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf%lf%lf%lf"</span>,&amp;x1,&amp;y1,&amp;x2,&amp;y2);</span><br><span class="line">            <span class="comment">//初始化线段</span></span><br><span class="line">            s[scnt+<span class="number">1</span>].l = s[scnt+<span class="number">2</span>].l = min(y1,y2);</span><br><span class="line">            s[scnt+<span class="number">1</span>].r = s[scnt+<span class="number">2</span>].r = max(y1,y2);</span><br><span class="line">            s[scnt+<span class="number">1</span>].x = x1; s[scnt+<span class="number">2</span>].x = x2;</span><br><span class="line">            s[scnt+<span class="number">1</span>].f = <span class="number">1</span>; s[scnt+<span class="number">2</span>].f = <span class="number">-1</span>;</span><br><span class="line">            pos[scnt+<span class="number">1</span>] = y1; pos[scnt+<span class="number">2</span>] = y2;</span><br><span class="line">            scnt += <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//离散化 </span></span><br><span class="line">        sort(s+<span class="number">1</span>,s+scnt+<span class="number">1</span>); <span class="comment">//把线段排序</span></span><br><span class="line">        sort(pos+<span class="number">1</span>,pos+scnt+<span class="number">1</span>); <span class="comment">//把离散化的查询表排序 </span></span><br><span class="line">        pcnt = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=scnt;i++)</span><br><span class="line">            <span class="keyword">if</span>(pos[i] != pos[i<span class="number">-1</span>])</span><br><span class="line">                pos[++pcnt] = pos[i];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//建树</span></span><br><span class="line">        sgt.build(<span class="number">1</span>,pcnt,<span class="number">1</span>); </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=scnt;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> l = lower_bound(pos+<span class="number">1</span>,pos+pcnt+<span class="number">1</span>,s[i].l)-pos; <span class="comment">//查找离散化之后的值</span></span><br><span class="line">            <span class="keyword">int</span> r = lower_bound(pos+<span class="number">1</span>,pos+pcnt+<span class="number">1</span>,s[i].r)-pos<span class="number">-1</span>; <span class="comment">//r要-1</span></span><br><span class="line">            sgt.modify(<span class="number">1</span>,pcnt,<span class="number">1</span>,l,r,s[i].f);</span><br><span class="line">            ans += (s[i+<span class="number">1</span>].x-s[i].x)*sgt.d[<span class="number">1</span>].len; <span class="comment">//统计答案</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Test case #%d\nTotal explored area: %.2lf\n\n"</span>,++kase,ans);</span><br><span class="line">        </span><br><span class="line">        n = read();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>$$ - - - - \mathcal{End} - - - -  $$</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/">线段树</a><a class="link-muted mr-2" rel="tag" href="/tags/%E6%89%AB%E6%8F%8F%E7%BA%BF%E6%B3%95/">扫描线法</a><a class="link-muted mr-2" rel="tag" href="/tags/%E7%BA%BF%E6%AE%B5%E8%A6%86%E7%9B%96/">线段覆盖</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/07/17/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91Duck%20and%20Dove/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">【题解】Duck and Dove</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/07/12/%E3%80%90%E9%A2%98%E8%A7%A3%E3%80%91%E8%A7%A3%E6%96%B9%E7%A8%8B/"><span class="level-item">【题解】解方程</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "J8OJ7MUCd2S0T59f6kSUn4E7-gzGzoHsz",
            appKey: "GToPzNfPvMfduDLYX58Pi03F",
            placeholder: "说些什么...",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">阅读推荐</h3><article class="media"><a class="media-left" href="/2019/03/29/OI%E6%A8%A1%E6%9D%BF%E6%A2%B3%E7%90%86/"><p class="image is-64x64"><img class="thumbnail" src="https://upl.big-news.cn/2019/08/09/photo-1489173910031-3df3560eee9b.jpg" alt="OI模板梳理"></p></a><div class="media-content size-small"><p><time dateTime="2019-03-29T12:45:00.000Z">2019-03-29</time></p><p class="title is-6"><a class="link-muted" href="/2019/03/29/OI%E6%A8%A1%E6%9D%BF%E6%A2%B3%E7%90%86/">OI模板梳理</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/OI%E7%AC%94%E8%AE%B0/">OI笔记</a></p></div></article><article class="media"><a class="media-left" href="/2019/02/07/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/"><p class="image is-64x64"><img class="thumbnail" src="https://upl.big-news.cn/2019/07/16/5d2d54141cf79.jpg" alt="强连通分量"></p></a><div class="media-content size-small"><p><time dateTime="2019-02-07T13:15:00.000Z">2019-02-07</time></p><p class="title is-6"><a class="link-muted" href="/2019/02/07/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/">强连通分量</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/OI%E7%AC%94%E8%AE%B0/">OI笔记</a></p></div></article><article class="media"><a class="media-left" href="/2019/07/18/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/"><p class="image is-64x64"><img class="thumbnail" src="https://upl.big-news.cn/2019/08/12/photo-1532256791400-f02a086ca4bd.jpg" alt="树链剖分"></p></a><div class="media-content size-small"><p><time dateTime="2019-07-18T12:20:00.000Z">2019-07-18</time></p><p class="title is-6"><a class="link-muted" href="/2019/07/18/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/">树链剖分</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/OI%E7%AC%94%E8%AE%B0/">OI笔记</a></p></div></article><article class="media"><a class="media-left" href="/2020/01/24/%E9%99%A4%E5%A4%95%E9%97%B2%E6%89%AF/"><p class="image is-64x64"><img class="thumbnail" src="https://upl.big-news.cn/2020/01/24/karina-vorozheeva-63frv9titrm-unsplash.jpg" alt="除夕闲扯"></p></a><div class="media-content size-small"><p><time dateTime="2020-01-23T22:47:00.000Z">2020-01-24</time></p><p class="title is-6"><a class="link-muted" href="/2020/01/24/%E9%99%A4%E5%A4%95%E9%97%B2%E6%89%AF/">除夕闲扯</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%9D%82%E8%B0%88/">杂谈</a></p></div></article><article class="media"><a class="media-left" href="/2020/08/07/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6%E5%86%8D%E5%9F%BA%E7%A1%80/"><p class="image is-64x64"><img class="thumbnail" src="https://upl.big-news.cn/2020/08/08/photo-1518133910546-b6c2fb7d79e3.jpg" alt="组合数学再基础"></p></a><div class="media-content size-small"><p><time dateTime="2020-08-07T06:00:00.000Z">2020-08-07</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/07/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6%E5%86%8D%E5%9F%BA%E7%A1%80/">组合数学再基础</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/OI%E7%AC%94%E8%AE%B0/">OI笔记</a></p></div></article></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#一-题目"><span class="nonedisplay">1</span><span>一 题目</span></a><ul class="menu-list"><li><a class="is-flex" href="#Descriptions"><span class="nonedisplay">1.1</span><span>Descriptions</span></a></li><li><a class="is-flex" href="#Input"><span class="nonedisplay">1.2</span><span>Input</span></a></li><li><a class="is-flex" href="#Output"><span class="nonedisplay">1.3</span><span>Output</span></a></li></ul></li><li><a class="is-flex" href="#二-题解"><span class="nonedisplay">2</span><span>二 题解</span></a><ul class="menu-list"><li><a class="is-flex" href="#题目大意"><span class="nonedisplay">2.1</span><span>题目大意</span></a></li><li><a class="is-flex" href="#思路"><span class="nonedisplay">2.2</span><span>思路</span></a></li><li><a class="is-flex" href="#细节"><span class="nonedisplay">2.3</span><span>细节</span></a></li></ul></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="bn&#039; Blog" height="28"></a><p class="size-small"><span>&copy; 2020 big-news</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="size-small"><a class="link-muted" href="/port/index.html">Port</a>  |  <a class="link-muted" href="http://beian.miit.gov.cn/" target="_blank">鲁ICP备19035721号-1</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="fab fa-creative-commons-nc"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Share Alike" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="fab fa-creative-commons-sa"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://big-news.cn',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>